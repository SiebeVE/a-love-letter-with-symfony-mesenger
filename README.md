# Symfony Messenger

- Async/sync
  - `git checkout initial`
  - `git checkout async`
  - `composer require symfony/messenger`
  - Created message
  - Added message to messenger config
    - Messenger DSN
  - Moved letter service to handler
    - Doctrine entities as id
- Process messages
  - Show messages in DB
  - `php bin/console messenger:consume -vv`
  - Edit consume, restart consumer
- Recap
- Failure handling
  - `git checkout failure`
  - Failure transport
    - Even multiple, nothing special about them
  - UnrecoverableFailure
    - `unrec`
  - Handling failures/retries
    - `php bin/console messenger:failed:show`
    - `php bin/console messenger:failed:retry`
      - Auto removed after 3 retries!
- Recap
- Different transports
  - `git checkout transports`
  - Also interface for routing (multiple transports)
  - Add queue name to dsn
  - `php bin/console messenger:consume priority async -vv`
  - Sync transport (debugging, design pattern,...)
- Recap
- Envelopes & Stamps
  - `git checkout envelope`
  - Delayed letter
    - `delay`
  - Extra info for transports/internal working
- Middleware
  - `git checkout middleware`
  - `php bin/console server:dump`
  - Default validation middleware
    - `\Symfony\Component\Messenger\Middleware\ValidationMiddleware::class`
  - Add unique id to message with envelope when message is first put on bus
  - `git checkout middleware-fix`
  - Keep consumer running and restart on failure
    - Supervisor
    - Docker
    - k8s
    - ! Watch out for memory limits, add memory-limit, limit messages
      - Reset on message
- Recap
- Closing
  - Symfony docs messenger
    - Different transports (rabbit mq,...)
  - Easy setup, really flexible
  - Missing UI for view messages/easy retry
